<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cable Ampacity Calculator</title>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
  <style>
    body {
      background: #f0f8ff;
      color: #fff;
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }
    .container {
      margin-top: 60px;
      background: #282c34;
      border-radius: 14px;
      box-shadow: 0 2px 16px rgba(0,0,0,0.18);
      padding: 36px 32px 32px 32px;
      max-width: 800px;
      width: 100%;
      text-align: center;
    }
    h1 {
      margin-bottom: 10px;
      font-size: 2.2rem;
      letter-spacing: 1px;
      color: #61dafb;
    }
    .input-group {
      margin: 18px 0 24px 0;
    }
    label {
      font-size: 1.1rem;
      margin-right: 8px;
    }
    input[type="number"] {
      padding: 10px;
      font-size: 1.1rem;
      border-radius: 6px;
      border: 1px solid #bbb;
      width: 120px;
      text-align: center;
      margin-right: 8px;
    }
    .results {
      margin-top: 18px;
      background: #22252b;
      border-radius: 10px;
      padding: 18px 10px 10px 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.12);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #444;
      padding: 8px 12px;
      font-size: 1.05rem;
    }
    th {
      background: #353a45;
      color: #61dafb;
    }
    tr:nth-child(even) {
      background: #2e323a;
    }
    tr:nth-child(odd) {
      background: #23262c;
    }
    td {
      color: #fff;
    }
    @media (max-width: 600px) {
      .container {
        padding: 18px 4px 18px 4px;
        max-width: 98vw;
      }
      th, td {
        padding: 6px 4px;
        font-size: 0.98rem;
      }
    }
    
    /* Loading Spinner */
    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #61dafb;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .loading {
      opacity: 0.6;
      pointer-events: none;
    }
    
    /* Toast Notifications */
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 8px;
      color: white;
      font-weight: bold;
      z-index: 1000;
      transform: translateX(400px);
      transition: transform 0.3s ease;
    }
    
    .toast.show {
      transform: translateX(0);
    }
    
    .toast.success {
      background: #4CAF50;
    }
    
    .toast.error {
      background: #f44336;
    }
    
    .toast.info {
      background: #2196F3;
    }
    
    /* Print Styles */
    @media print {
      body {
        background: white !important;
        color: black !important;
      }
      
      .container, .cable-library, .circuit-breaker-library, .switch-library {
        background: white !important;
        color: black !important;
        box-shadow: none !important;
        border: 1px solid #ccc !important;
      }
      
      h1, h2, h3 {
        color: black !important;
      }
      
      table {
        border: 1px solid #000 !important;
      }
      
      th, td {
        border: 1px solid #000 !important;
        color: black !important;
        background: white !important;
      }
      
      button, input, select {
        display: none !important;
      }
      
      #minimumComponents {
        page-break-inside: avoid;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Cable Ampacity Calculator</h1>
    <div class="input-group">
      <label for="currentInput">Rated Current (Amps):</label>
      <input type="number" id="currentInput" min="0" placeholder="e.g. 12" />
    </div>
    <div id="results" class="results" style="display:none;"></div>
  </div>
  <div style="margin-top: 24px; font-size: 0.95rem; color: #000; text-align: center;">
    Ampacity data referenced from SEMI S22-1110b Standard.
  </div>

     <div class="cable-library" style="margin: 40px auto 0 auto; max-width: 800px; background: #23262c; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.12); padding: 28px 18px;">
    <h2 style="color: #61dafb; margin-bottom: 18px;">Cable Library</h2>
    <form id="cableForm" style="display: flex; flex-wrap: wrap; gap: 12px; align-items: flex-end; justify-content: center;">
      <div>
        <label for="cableCategory">Category:</label><br>
        <select id="cableCategory" required>
          <option value="Single Core">Single Core</option>
          <option value="Multi Core">Multi Core</option>
          <option value="Robotic Cable">Robotic Cable</option>
          <option value="Flexible Cable">Flexible Cable</option>
        </select>
      </div>
      <div>
        <label for="oemPart">OEM Part Number:</label><br>
        <input type="text" id="oemPart" required style="width: 120px;" />
      </div>
      <div>
        <label for="cableDesc">Description:</label><br>
        <input type="text" id="cableDesc" required style="width: 160px;" />
      </div>
      <div>
        <label for="numCores">No. of Cores:</label><br>
        <input type="number" id="numCores" min="1" required style="width: 60px;" />
      </div>
      <div>
        <label for="cableRating">Rating (A):</label><br>
        <input type="number" id="cableRating" min="1" required style="width: 60px;" />
      </div>
      <div>
        <button type="submit" style="padding: 8px 18px; background: #61dafb; color: #23262c; border: none; border-radius: 6px; font-weight: bold; cursor: pointer;">Add Cable</button>
      </div>
    </form>
    <div id="cableTables" style="margin-top: 30px;"></div>
    <div style="margin-top: 18px;">
      <input type="text" id="searchOEM" placeholder="Search by OEM Part No or Rating" style="padding: 7px 12px; border-radius: 6px; border: 1px solid #bbb; width: 300px; font-size: 1rem;" />
    </div>
  </div>
  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyB_8ntUz0TnWzTtygzZ-r7d-9yVg-zj254",
      authDomain: "attendance-ac65f.firebaseapp.com",
      projectId: "attendance-ac65f",
      storageBucket: "attendance-ac65f.firebasestorage.app",
      messagingSenderId: "156838355463",
      appId: "1:156838355463:web:c0533dfeae05014a0d40a2",
      measurementId: "G-614JWRFCLQ"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Metric ampacity table for 60°C (AWG, mm², Amps, Bending Space mm) from the image
    const ampacityTable = [
      { awg: '22', mm2: 0.25, amps: 3, bend_mm: 13 },
      { awg: '20', mm2: 0.5, amps: 5, bend_mm: 13 },
      { awg: '18', mm2: 0.75, amps: 6, bend_mm: 13 },
      { awg: '16', mm2: 1.0, amps: 8, bend_mm: 19 },
      { awg: '14', mm2: 1.5, amps: 11, bend_mm: 19 },
      { awg: '12', mm2: 2.5, amps: 17, bend_mm: 25 },
      { awg: '10', mm2: 4.0, amps: 24, bend_mm: 25 },
      { awg: '8', mm2: 6.0, amps: 32, bend_mm: 38 },
      { awg: '6', mm2: 10.0, amps: 45, bend_mm: 51 },
      { awg: '4', mm2: 16.0, amps: 60, bend_mm: 76 },
    ];

    const input = document.getElementById('currentInput');
    const resultsDiv = document.getElementById('results');

    input.addEventListener('input', function() {
      const value = parseFloat(input.value);
      if (isNaN(value) || value <= 0) {
        resultsDiv.style.display = 'none';
        resultsDiv.innerHTML = '';
        return;
      }
      const filtered = ampacityTable.filter(row => value <= row.amps);
      let html = '<h2>Suitable Cable Sizes (60°C)</h2>';
      if (filtered.length > 0) {
        html += '<table><thead><tr><th>AWG</th><th>Metric (mm²)</th><th>Max Amps</th><th>Bending Space (mm)</th></tr></thead><tbody>';
        filtered.forEach(row => {
          html += `<tr><td>${row.awg}</td><td>${row.mm2}</td><td>${row.amps}</td><td>${row.bend_mm}</td></tr>`;
        });
        html += '</tbody></table>';
      } else {
        html += '<div style="margin-top:10px; color:#ff7675;">No suitable size found</div>';
      }
      resultsDiv.innerHTML = html;
      resultsDiv.style.display = 'block';
      
      // Show minimum components from libraries
      showMinimumComponents(value);
    });

    // --- Cable Library Section ---
    const cableForm = document.getElementById('cableForm');
    const cableTablesDiv = document.getElementById('cableTables');
    let cableLibrary = {
      'Single Core': [],
      'Multi Core': [],
      'Robotic Cable': [],
      'Flexible Cable': []
    };

    cableForm.addEventListener('submit', function(e) {
      e.preventDefault();
      const cableCategory = document.getElementById('cableCategory').value;
      const oemPart = document.getElementById('oemPart').value.trim();
      const cableDesc = document.getElementById('cableDesc').value.trim();
      const numCores = document.getElementById('numCores').value.trim();
      const cableRating = document.getElementById('cableRating').value.trim();
      if (!cableCategory || !oemPart || !cableDesc || !numCores || !cableRating) return;
      
      // Add to local array
      cableLibrary[cableCategory].push({ oemPart, cableDesc, numCores, cableRating });
      
      // Save to Firebase
      saveCableToFirebase(cableCategory, { oemPart, cableDesc, numCores, cableRating }).then(() => {
        showToast('Cable added successfully!', 'success');
        cableForm.reset();
        renderCableTables();
      }).catch(() => {
        showToast('Error adding cable. Please try again.', 'error');
      });
    });

    const searchOEM = document.getElementById('searchOEM');
    searchOEM.addEventListener('input', renderCableTables);

    function renderCableTables() {
      let html = '';
      const searchVal = searchOEM.value.trim().toLowerCase();
      let found = false;
      Object.keys(cableLibrary).forEach(cat => {
        // Filter cables by search value
        const filteredCables = searchVal
          ? cableLibrary[cat].filter(cable => 
              cable.oemPart.toLowerCase().includes(searchVal) || 
              cable.numCores.toString().includes(searchVal) ||
              cable.cableRating.toString().includes(searchVal)
            )
          : cableLibrary[cat];
        if (filteredCables.length === 0) return;
        found = true;
        html += `<h3 style='color:#ffb347; margin-bottom:6px;'>${cat}</h3>`;
        html += `<table style='margin-bottom:18px;'><thead><tr><th>OEM Part Number</th><th>Description</th><th>No. of Cores</th><th>Rating (A)</th><th>Action</th></tr></thead><tbody>`;
        filteredCables.forEach((cable, idx) => {
          html += `<tr><td>${cable.oemPart}</td><td>${cable.cableDesc}</td><td>${cable.numCores}</td><td>${cable.cableRating}</td><td><button class='remove-cable-btn' data-cat='${cat}' data-idx='${cableLibrary[cat].indexOf(cable)}' style='padding:3px 10px;background:#ff7675;color:#fff;border:none;border-radius:4px;cursor:pointer;'>Remove</button></td></tr>`;
        });
        html += '</tbody></table>';
      });
      cableTablesDiv.innerHTML = found ? html : '<div style="color:#bbb;">No cables found.</div>';
    }
    renderCableTables();

    // Remove cable event (event delegation)
    cableTablesDiv.addEventListener('click', function(e) {
      if (e.target.classList.contains('remove-cable-btn')) {
        const cableCategory = e.target.getAttribute('data-cat');
        const idx = parseInt(e.target.getAttribute('data-idx'));
        const cableToRemove = cableLibrary[cableCategory][idx];
        if (confirm('Are you sure you want to remove this cable?')) {
          deleteCableFromFirebase(cableToRemove.id).then(() => {
            cableLibrary[cableCategory].splice(idx, 1);
            renderCableTables();
            showToast('Cable removed successfully!', 'success');
          }).catch(() => {
            showToast('Error removing cable. Please try again.', 'error');
          });
        }
      }
    });

    // Firebase functions for Cable Library
    function saveCableToFirebase(category, cableData) {
      const submitBtn = cableForm.querySelector('button[type="submit"]');
      const originalText = submitBtn.textContent;
      submitBtn.innerHTML = '<span class="spinner"></span> Saving...';
      submitBtn.disabled = true;
      
      return db.collection('cables').add({
        category: category,
        oemPart: cableData.oemPart,
        cableDesc: cableData.cableDesc,
        numCores: cableData.numCores,
        cableRating: cableData.cableRating,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      }).then(() => {
        console.log('Cable saved to Firebase');
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
        return true;
      }).catch((error) => {
        console.error('Error saving cable: ', error);
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
        return false;
      });
    }

    function loadCablesFromFirebase() {
      db.collection('cables').get().then((querySnapshot) => {
        cableLibrary = {
          'Single Core': [],
          'Multi Core': [],
          'Robotic Cable': [],
          'Flexible Cable': []
        };
        
        querySnapshot.forEach((doc) => {
          const data = doc.data();
          if (cableLibrary[data.category]) {
            cableLibrary[data.category].push({
              id: doc.id,
              oemPart: data.oemPart,
              cableDesc: data.cableDesc,
              numCores: data.numCores,
              cableRating: data.cableRating
            });
          }
        });
        renderCableTables();
      }).catch((error) => {
        console.error('Error loading cables: ', error);
      });
    }

    function deleteCableFromFirebase(docId) {
      return db.collection('cables').doc(docId).delete().then(() => {
        console.log('Cable deleted from Firebase');
        return true;
      }).catch((error) => {
        console.error('Error deleting cable: ', error);
        return false;
      });
    }

    // Load cables on page load
    loadCablesFromFirebase();
    
    // Toast notification function
    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => toast.classList.add('show'), 100);
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => document.body.removeChild(toast), 300);
      }, 3000);
    }
  </script>

     <div class="circuit-breaker-library" style="margin: 40px auto 0 auto; max-width: 800px; background: #23262c; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.12); padding: 28px 18px;">
    <h2 style="color: #61dafb; margin-bottom: 18px;">Circuit Breaker Library</h2>
    <form id="cbForm" style="display: flex; flex-wrap: wrap; gap: 12px; align-items: flex-end; justify-content: center;">
      <div>
        <label for="cbCategory">Category:</label><br>
        <select id="cbCategory" required>
          <option value="Main CB">Main CB</option>
          <option value="RCCB">RCCB</option>
          <option value="CB">CB</option>
          <option value="DCB">DCB</option>
        </select>
      </div>
      <div>
        <label for="cbOEMPart">OEM Part Number:</label><br>
        <input type="text" id="cbOEMPart" required style="width: 120px;" />
      </div>
      <div>
        <label for="cbDesc">Description:</label><br>
        <input type="text" id="cbDesc" required style="width: 160px;" />
      </div>
      <div>
        <label for="cbPoles">Poles:</label><br>
        <input type="number" id="cbPoles" min="1" max="4" required style="width: 60px;" />
      </div>
      <div>
        <label for="cbRating">Rating (A):</label><br>
        <input type="number" id="cbRating" min="1" required style="width: 60px;" />
      </div>
      <div>
        <button type="submit" style="padding: 8px 18px; background: #61dafb; color: #23262c; border: none; border-radius: 6px; font-weight: bold; cursor: pointer;">Add CB</button>
      </div>
    </form>
    <div id="cbTables" style="margin-top: 30px;"></div>
    <div style="margin-top: 18px;">
      <input type="text" id="searchCBOEM" placeholder="Search by OEM Part No or Rating" style="padding: 7px 12px; border-radius: 6px; border: 1px solid #bbb; width: 300px; font-size: 1rem;" />
    </div>
  </div>
  <script>
    // --- Circuit Breaker Library Section ---
    const cbForm = document.getElementById('cbForm');
    const cbTablesDiv = document.getElementById('cbTables');
    const searchCBOEM = document.getElementById('searchCBOEM');
    let cbLibrary = {
      'Main CB': [],
      'RCCB': [],
      'CB': [],
      'DCB': []
    };

    cbForm.addEventListener('submit', function(e) {
      e.preventDefault();
      const cbCategory = document.getElementById('cbCategory').value;
      const cbOEMPart = document.getElementById('cbOEMPart').value.trim();
      const cbDesc = document.getElementById('cbDesc').value.trim();
      const cbPoles = document.getElementById('cbPoles').value.trim();
      const cbRating = document.getElementById('cbRating').value.trim();
      if (!cbCategory || !cbOEMPart || !cbDesc || !cbPoles || !cbRating) return;
      
      // Add to local array
      cbLibrary[cbCategory].push({ cbOEMPart, cbDesc, cbPoles, cbRating });
      
      // Save to Firebase
      saveCBToFirebase(cbCategory, { cbOEMPart, cbDesc, cbPoles, cbRating }).then(() => {
        showToast('Circuit Breaker added successfully!', 'success');
        cbForm.reset();
        renderCBTables();
      }).catch(() => {
        showToast('Error adding circuit breaker. Please try again.', 'error');
      });
    });

    // Firebase functions for Circuit Breaker Library
    function saveCBToFirebase(category, cbData) {
      const submitBtn = cbForm.querySelector('button[type="submit"]');
      const originalText = submitBtn.textContent;
      submitBtn.innerHTML = '<span class="spinner"></span> Saving...';
      submitBtn.disabled = true;
      
      return db.collection('circuitBreakers').add({
        category: category,
        cbOEMPart: cbData.cbOEMPart,
        cbDesc: cbData.cbDesc,
        cbPoles: cbData.cbPoles,
        cbRating: cbData.cbRating,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      }).then(() => {
        console.log('Circuit Breaker saved to Firebase');
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
        return true;
      }).catch((error) => {
        console.error('Error saving circuit breaker: ', error);
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
        return false;
      });
    }

    function loadCBsFromFirebase() {
      db.collection('circuitBreakers').get().then((querySnapshot) => {
        cbLibrary = {
          'Main CB': [],
          'RCCB': [],
          'CB': [],
          'DCB': []
        };
        
        querySnapshot.forEach((doc) => {
          const data = doc.data();
          if (cbLibrary[data.category]) {
            cbLibrary[data.category].push({
              id: doc.id,
              cbOEMPart: data.cbOEMPart,
              cbDesc: data.cbDesc,
              cbPoles: data.cbPoles,
              cbRating: data.cbRating
            });
          }
        });
        renderCBTables();
      }).catch((error) => {
        console.error('Error loading circuit breakers: ', error);
      });
    }

    function deleteCBFromFirebase(docId) {
      return db.collection('circuitBreakers').doc(docId).delete().then(() => {
        console.log('Circuit Breaker deleted from Firebase');
        return true;
      }).catch((error) => {
        console.error('Error deleting circuit breaker: ', error);
        return false;
      });
    }

    // Load circuit breakers on page load
    loadCBsFromFirebase();

    searchCBOEM.addEventListener('input', renderCBTables);

    function renderCBTables() {
      let html = '';
      const searchVal = searchCBOEM.value.trim().toLowerCase();
      let found = false;
      Object.keys(cbLibrary).forEach(cat => {
        const filteredCBs = searchVal
          ? cbLibrary[cat].filter(cb => 
              cb.cbOEMPart.toLowerCase().includes(searchVal) || 
              cb.cbRating.toString().includes(searchVal)
            )
          : cbLibrary[cat];
        if (filteredCBs.length === 0) return;
        found = true;
        html += `<h3 style='color:#ffb347; margin-bottom:6px;'>${cat}</h3>`;
        html += `<table style='margin-bottom:18px;'><thead><tr><th>OEM Part Number</th><th>Description</th><th>Poles</th><th>Rating (A)</th><th>Action</th></tr></thead><tbody>`;
        filteredCBs.forEach((cb, idx) => {
          html += `<tr><td>${cb.cbOEMPart}</td><td>${cb.cbDesc}</td><td>${cb.cbPoles}</td><td>${cb.cbRating}</td><td><button class='remove-cb-btn' data-cat='${cat}' data-idx='${cbLibrary[cat].indexOf(cb)}' style='padding:3px 10px;background:#ff7675;color:#fff;border:none;border-radius:4px;cursor:pointer;'>Remove</button></td></tr>`;
        });
        html += '</tbody></table>';
      });
      cbTablesDiv.innerHTML = found ? html : '<div style="color:#bbb;">No circuit breakers found.</div>';
    }

    // Remove CB event (event delegation)
    cbTablesDiv.addEventListener('click', function(e) {
      if (e.target.classList.contains('remove-cb-btn')) {
        const cbCat = e.target.getAttribute('data-cat');
        const idx = parseInt(e.target.getAttribute('data-idx'));
        const cbToRemove = cbLibrary[cbCat][idx];
        if (confirm('Are you sure you want to remove this circuit breaker?')) {
          deleteCBFromFirebase(cbToRemove.id).then(() => {
            cbLibrary[cbCat].splice(idx, 1);
            renderCBTables();
            showToast('Circuit Breaker removed successfully!', 'success');
          }).catch(() => {
            showToast('Error removing circuit breaker. Please try again.', 'error');
          });
        }
      }
    });

    renderCBTables();
  </script>

     <div class="switch-library" style="margin: 40px auto 0 auto; max-width: 800px; background: #23262c; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.12); padding: 28px 18px;">
    <h2 style="color: #61dafb; margin-bottom: 18px;">Switch Library</h2>
    <form id="switchForm" style="display: flex; flex-wrap: wrap; gap: 12px; align-items: flex-end; justify-content: center;">
      <div>
        <label for="switchCategory">Category:</label><br>
        <select id="switchCategory" required>
          <option value="Relay">Relay</option>
          <option value="Contactor">Contactor</option>
        </select>
      </div>
      <div>
        <label for="switchOEMPart">OEM Part Number:</label><br>
        <input type="text" id="switchOEMPart" required style="width: 120px;" />
      </div>
      <div>
        <label for="switchDesc">Description:</label><br>
        <input type="text" id="switchDesc" required style="width: 160px;" />
      </div>
      <div>
        <label for="switchPoles">Poles:</label><br>
        <input type="number" id="switchPoles" min="1" max="4" required style="width: 60px;" />
      </div>
      <div>
        <label for="switchRating">Rating (A):</label><br>
        <input type="number" id="switchRating" min="1" required style="width: 60px;" />
      </div>
      <div>
        <button type="submit" style="padding: 8px 18px; background: #61dafb; color: #23262c; border: none; border-radius: 6px; font-weight: bold; cursor: pointer;">Add Switch</button>
      </div>
    </form>
    <div id="switchTables" style="margin-top: 30px;"></div>
    <div style="margin-top: 18px;">
      <input type="text" id="searchSwitchOEM" placeholder="Search by OEM Part No or Rating" style="padding: 7px 12px; border-radius: 6px; border: 1px solid #bbb; width: 300px; font-size: 1rem;" />
    </div>
  </div>
  <script>
    // --- Switch Library Section ---
    const switchForm = document.getElementById('switchForm');
    const switchTablesDiv = document.getElementById('switchTables');
    const searchSwitchOEM = document.getElementById('searchSwitchOEM');
    let switchLibrary = {
      'Relay': [],
      'Contactor': []
    };

    switchForm.addEventListener('submit', function(e) {
      e.preventDefault();
      const switchCategory = document.getElementById('switchCategory').value;
      const switchOEMPart = document.getElementById('switchOEMPart').value.trim();
      const switchDesc = document.getElementById('switchDesc').value.trim();
      const switchPoles = document.getElementById('switchPoles').value.trim();
      const switchRating = document.getElementById('switchRating').value.trim();
      if (!switchCategory || !switchOEMPart || !switchDesc || !switchPoles || !switchRating) return;
      
      // Add to local array
      switchLibrary[switchCategory].push({ switchOEMPart, switchDesc, switchPoles, switchRating });
      
      // Save to Firebase
      saveSwitchToFirebase(switchCategory, { switchOEMPart, switchDesc, switchPoles, switchRating }).then(() => {
        showToast('Switch added successfully!', 'success');
        switchForm.reset();
        renderSwitchTables();
      }).catch(() => {
        showToast('Error adding switch. Please try again.', 'error');
      });
    });

    // Firebase functions for Switch Library
    function saveSwitchToFirebase(category, switchData) {
      const submitBtn = switchForm.querySelector('button[type="submit"]');
      const originalText = submitBtn.textContent;
      submitBtn.innerHTML = '<span class="spinner"></span> Saving...';
      submitBtn.disabled = true;
      
      return db.collection('switches').add({
        category: category,
        switchOEMPart: switchData.switchOEMPart,
        switchDesc: switchData.switchDesc,
        switchPoles: switchData.switchPoles,
        switchRating: switchData.switchRating,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      }).then(() => {
        console.log('Switch saved to Firebase');
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
        return true;
      }).catch((error) => {
        console.error('Error saving switch: ', error);
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
        return false;
      });
    }

    function loadSwitchesFromFirebase() {
      db.collection('switches').get().then((querySnapshot) => {
        switchLibrary = {
          'Relay': [],
          'Contactor': []
        };
        
        querySnapshot.forEach((doc) => {
          const data = doc.data();
          if (switchLibrary[data.category]) {
            switchLibrary[data.category].push({
              id: doc.id,
              switchOEMPart: data.switchOEMPart,
              switchDesc: data.switchDesc,
              switchPoles: data.switchPoles,
              switchRating: data.switchRating
            });
          }
        });
        renderSwitchTables();
      }).catch((error) => {
        console.error('Error loading switches: ', error);
      });
    }

    function deleteSwitchFromFirebase(docId) {
      return db.collection('switches').doc(docId).delete().then(() => {
        console.log('Switch deleted from Firebase');
        return true;
      }).catch((error) => {
        console.error('Error deleting switch: ', error);
        return false;
      });
    }

    // Load switches on page load
    loadSwitchesFromFirebase();

    searchSwitchOEM.addEventListener('input', renderSwitchTables);

    function renderSwitchTables() {
      let html = '';
      const searchVal = searchSwitchOEM.value.trim().toLowerCase();
      let found = false;
      Object.keys(switchLibrary).forEach(cat => {
        const filteredSwitches = searchVal
          ? switchLibrary[cat].filter(sw => 
              sw.switchOEMPart.toLowerCase().includes(searchVal) || 
              sw.switchRating.toString().includes(searchVal)
            )
          : switchLibrary[cat];
        if (filteredSwitches.length === 0) return;
        found = true;
        html += `<h3 style='color:#ffb347; margin-bottom:6px;'>${cat}</h3>`;
        html += `<table style='margin-bottom:18px;'><thead><tr><th>OEM Part Number</th><th>Description</th><th>Poles</th><th>Rating (A)</th><th>Action</th></tr></thead><tbody>`;
        filteredSwitches.forEach((sw, idx) => {
          html += `<tr><td>${sw.switchOEMPart}</td><td>${sw.switchDesc}</td><td>${sw.switchPoles}</td><td>${sw.switchRating}</td><td><button class='remove-switch-btn' data-cat='${cat}' data-idx='${switchLibrary[cat].indexOf(sw)}' style='padding:3px 10px;background:#ff7675;color:#fff;border:none;border-radius:4px;cursor:pointer;'>Remove</button></td></tr>`;
        });
        html += '</tbody></table>';
      });
      switchTablesDiv.innerHTML = found ? html : '<div style="color:#bbb;">No switches found.</div>';
    }

    // Remove Switch event (event delegation)
    switchTablesDiv.addEventListener('click', function(e) {
      if (e.target.classList.contains('remove-switch-btn')) {
        const switchCat = e.target.getAttribute('data-cat');
        const idx = parseInt(e.target.getAttribute('data-idx'));
        const switchToRemove = switchLibrary[switchCat][idx];
        if (confirm('Are you sure you want to remove this switch?')) {
          deleteSwitchFromFirebase(switchToRemove.id).then(() => {
            switchLibrary[switchCat].splice(idx, 1);
            renderSwitchTables();
            showToast('Switch removed successfully!', 'success');
          }).catch(() => {
            showToast('Error removing switch. Please try again.', 'error');
          });
        }
      }
    });

    renderSwitchTables();
  </script>

  <script>
    // Function to show minimum components from libraries
    function showMinimumComponents(currentRating) {
      let componentsHtml = '<div style="margin-top: 40px; max-width: 800px; margin-left: auto; margin-right: auto;">';
      componentsHtml += '<h2 style="color: #61dafb; text-align: center; margin-bottom: 20px;">Minimum Components for ' + currentRating + 'A</h2>';
      
      // Cable Library components
      let suitableCables = [];
      Object.keys(cableLibrary).forEach(cat => {
        cableLibrary[cat].forEach(cable => {
          if (parseInt(cable.cableRating) >= currentRating) {
            suitableCables.push({...cable, category: cat});
          }
        });
      });
      
      if (suitableCables.length > 0) {
        componentsHtml += '<div style="background: #23262c; border-radius: 12px; padding: 20px; margin-bottom: 20px;">';
        componentsHtml += '<h3 style="color: #ffb347; margin-bottom: 10px;">Suitable Cables</h3>';
        componentsHtml += '<table style="width: 100%; border-collapse: collapse;"><thead><tr><th style="border: 1px solid #444; padding: 8px; background: #353a45; color: #61dafb;">Category</th><th style="border: 1px solid #444; padding: 8px; background: #353a45; color: #61dafb;">OEM Part Number</th><th style="border: 1px solid #444; padding: 8px; background: #353a45; color: #61dafb;">Description</th><th style="border: 1px solid #444; padding: 8px; background: #353a45; color: #61dafb;">No. of Cores</th><th style="border: 1px solid #444; padding: 8px; background: #353a45; color: #61dafb;">Rating (A)</th></tr></thead><tbody>';
        suitableCables.forEach(cable => {
          componentsHtml += `<tr style="background: #2e323a;"><td style="border: 1px solid #444; padding: 8px; color: #fff;">${cable.category}</td><td style="border: 1px solid #444; padding: 8px; color: #fff;">${cable.oemPart}</td><td style="border: 1px solid #444; padding: 8px; color: #fff;">${cable.cableDesc}</td><td style="border: 1px solid #444; padding: 8px; color: #fff;">${cable.numCores}</td><td style="border: 1px solid #444; padding: 8px; color: #fff;">${cable.cableRating}</td></tr>`;
        });
        componentsHtml += '</tbody></table></div>';
      }
      
      // Circuit Breaker Library components
      let suitableCBs = [];
      Object.keys(cbLibrary).forEach(cat => {
        cbLibrary[cat].forEach(cb => {
          if (parseInt(cb.cbRating) >= currentRating) {
            suitableCBs.push({...cb, category: cat});
          }
        });
      });
      
      if (suitableCBs.length > 0) {
        componentsHtml += '<div style="background: #23262c; border-radius: 12px; padding: 20px; margin-bottom: 20px;">';
        componentsHtml += '<h3 style="color: #ffb347; margin-bottom: 10px;">Suitable Circuit Breakers</h3>';
        componentsHtml += '<table style="width: 100%; border-collapse: collapse;"><thead><tr><th style="border: 1px solid #444; padding: 8px; background: #353a45; color: #61dafb;">Category</th><th style="border: 1px solid #444; padding: 8px; background: #353a45; color: #61dafb;">OEM Part Number</th><th style="border: 1px solid #444; padding: 8px; background: #353a45; color: #61dafb;">Description</th><th style="border: 1px solid #444; padding: 8px; background: #353a45; color: #61dafb;">Poles</th><th style="border: 1px solid #444; padding: 8px; background: #353a45; color: #61dafb;">Rating (A)</th></tr></thead><tbody>';
        suitableCBs.forEach(cb => {
          componentsHtml += `<tr style="background: #2e323a;"><td style="border: 1px solid #444; padding: 8px; color: #fff;">${cb.category}</td><td style="border: 1px solid #444; padding: 8px; color: #fff;">${cb.cbOEMPart}</td><td style="border: 1px solid #444; padding: 8px; color: #fff;">${cb.cbDesc}</td><td style="border: 1px solid #444; padding: 8px; color: #fff;">${cb.cbPoles}</td><td style="border: 1px solid #444; padding: 8px; color: #fff;">${cb.cbRating}</td></tr>`;
        });
        componentsHtml += '</tbody></table></div>';
      }
      
      // Switch Library components
      let suitableSwitches = [];
      Object.keys(switchLibrary).forEach(cat => {
        switchLibrary[cat].forEach(sw => {
          if (parseInt(sw.switchRating) >= currentRating) {
            suitableSwitches.push({...sw, category: cat});
          }
        });
      });
      
      if (suitableSwitches.length > 0) {
        componentsHtml += '<div style="background: #23262c; border-radius: 12px; padding: 20px; margin-bottom: 20px;">';
        componentsHtml += '<h3 style="color: #ffb347; margin-bottom: 10px;">Suitable Switches</h3>';
        componentsHtml += '<table style="width: 100%; border-collapse: collapse;"><thead><tr><th style="border: 1px solid #444; padding: 8px; background: #353a45; color: #61dafb;">Category</th><th style="border: 1px solid #444; padding: 8px; background: #353a45; color: #61dafb;">OEM Part Number</th><th style="border: 1px solid #444; padding: 8px; background: #353a45; color: #61dafb;">Description</th><th style="border: 1px solid #444; padding: 8px; background: #353a45; color: #61dafb;">Poles</th><th style="border: 1px solid #444; padding: 8px; background: #353a45; color: #61dafb;">Rating (A)</th></tr></thead><tbody>';
        suitableSwitches.forEach(sw => {
          componentsHtml += `<tr style="background: #2e323a;"><td style="border: 1px solid #444; padding: 8px; color: #fff;">${sw.category}</td><td style="border: 1px solid #444; padding: 8px; color: #fff;">${sw.switchOEMPart}</td><td style="border: 1px solid #444; padding: 8px; color: #fff;">${sw.switchDesc}</td><td style="border: 1px solid #444; padding: 8px; color: #fff;">${sw.switchPoles}</td><td style="border: 1px solid #444; padding: 8px; color: #fff;">${sw.switchRating}</td></tr>`;
        });
        componentsHtml += '</tbody></table></div>';
      }
      
      if (suitableCables.length === 0 && suitableCBs.length === 0 && suitableSwitches.length === 0) {
        componentsHtml += '<div style="background: #23262c; border-radius: 12px; padding: 20px; text-align: center; color: #bbb;">No suitable components found in libraries for ' + currentRating + 'A. Add components with higher ratings to your libraries.</div>';
      }
      
      componentsHtml += '</div>';
      
      // Add the components section after the results
      const existingComponents = document.getElementById('minimumComponents');
      if (existingComponents) {
        existingComponents.remove();
      }
      
      const componentsDiv = document.createElement('div');
      componentsDiv.id = 'minimumComponents';
      componentsDiv.innerHTML = componentsHtml;
      resultsDiv.parentNode.insertBefore(componentsDiv, resultsDiv.nextSibling);
    }
  </script>
</body>
</html> 
